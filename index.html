<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content='"Is it nothing to you, all ye that pass by? behold, and see if there be any sorrow like unto my sorrow"'>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Lamentations</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link href="assets/css/ipython.min.css" rel="stylesheet" type="text/css">
<link href="assets/css/nikola_ipython.css" rel="stylesheet" type="text/css">
<meta content="#5670d4" name="theme-color">
<link rel="alternate" type="application/rss+xml" title="RSS" href="rss.xml">
<link rel="canonical" href="http://perryjer1.github.io/">
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'left', // Change this to 'center' to center equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script><!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><link rel="prefetch" href="posts/summarylm-in-r/" type="text/html">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-inverse navbar-static-top"><div class="container">
<!-- This keeps the margins nice -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://perryjer1.github.io/">

                <span id="blog-title">Lamentations</span>
            </a>
        </div>
<!-- /.navbar-header -->
        <div class="collapse navbar-collapse" id="bs-navbar" aria-expanded="false">
            <ul class="nav navbar-nav">
<li>
<a href="pages/about/">About</a>
                </li>
<li>
<a href="archive.html">Archive</a>
                </li>
<li>
<a href="categories/">Tags</a>
                </li>
<li>
<a href="rss.xml">RSS feed</a>

                
            </li>
</ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        <div class="row">
            
            

    
<div class="postindex">
    <article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/summarylm-in-r/" class="u-url">summary.lm in R</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Jeremiah Perry
            </span></p>
            <p class="dateline"><a href="posts/summarylm-in-r/" rel="bookmark"><time class="published dt-published" datetime="2017-05-24T17:01:21-05:00" title="2017-05-24 17:01">2017-05-24 17:01</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Matching-summary(lm(...))-output">Matching <code>summary(lm(...))</code> output<a class="anchor-link" href="posts/summarylm-in-r/#Matching-summary(lm(...))-output">¶</a>
</h2>
<p>These are my notes on matching the report that is printed when you call <code>summary</code> on a linear model in R.</p>
<p>We will use the <code>trees</code> dataset. <code>Girth</code> is the tree diameter in inches, <code>Height</code> is the tree height in feet, <code>Volume</code> is the amount of timber in cubic feet.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Univariate-case">Univariate case<a class="anchor-link" href="posts/summarylm-in-r/#Univariate-case">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span>data<span class="p">(</span>trees<span class="p">)</span>
model1 <span class="o">&lt;-</span> lm<span class="p">(</span>Volume <span class="o">~</span> Girth<span class="p">,</span> data <span class="o">=</span> trees<span class="p">)</span>
<span class="kp">summary</span><span class="p">(</span>model1<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_text output_subarea ">
<pre>
Call:
lm(formula = Volume ~ Girth, data = trees)

Residuals:
   Min     1Q Median     3Q    Max 
-8.065 -3.107  0.152  3.495  9.587 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -36.9435     3.3651  -10.98 7.62e-12 ***
Girth         5.0659     0.2474   20.48  &lt; 2e-16 ***
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 4.252 on 29 degrees of freedom
Multiple R-squared:  0.9353,	Adjusted R-squared:  0.9331 
F-statistic: 419.4 on 1 and 29 DF,  p-value: &lt; 2.2e-16
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Residuals">Residuals<a class="anchor-link" href="posts/summarylm-in-r/#Residuals">¶</a>
</h4>
<p>The $\hat{y_i}$ are found in the <code>fitted.values</code> field. The residuals $y_i - \hat{y_i}$ are in the <code>residuals</code> field. Each can be extracted using the <code>fitted</code> and <code>residuals</code> functions. We can get the residual quantiles by using either one.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="kp">round</span><span class="p">(</span>quantile<span class="p">(</span>trees<span class="o">$</span>Volume <span class="o">-</span> fitted<span class="p">(</span>model1<span class="p">)),</span> <span class="m">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<dl class="dl-horizontal">
<dt>0%</dt>
		<dd>-8.065</dd>
	<dt>25%</dt>
		<dd>-3.107</dd>
	<dt>50%</dt>
		<dd>0.152</dd>
	<dt>75%</dt>
		<dd>3.495</dd>
	<dt>100%</dt>
		<dd>9.587</dd>
</dl>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="kp">round</span><span class="p">(</span>quantile<span class="p">(</span>residuals<span class="p">(</span>model1<span class="p">)),</span> <span class="m">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<dl class="dl-horizontal">
<dt>0%</dt>
		<dd>-8.065</dd>
	<dt>25%</dt>
		<dd>-3.107</dd>
	<dt>50%</dt>
		<dd>0.152</dd>
	<dt>75%</dt>
		<dd>3.495</dd>
	<dt>100%</dt>
		<dd>9.587</dd>
</dl>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Coefficients">Coefficients<a class="anchor-link" href="posts/summarylm-in-r/#Coefficients">¶</a>
</h4>
<p>Coefficients are found by $\beta = (X^T X)^{-1} X^T y$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span>X <span class="o">&lt;-</span> model.matrix<span class="p">(</span><span class="o">~</span> Girth<span class="p">,</span> data <span class="o">=</span> trees<span class="p">)</span>
beta <span class="o">&lt;-</span> <span class="kp">round</span><span class="p">(</span><span class="kp">solve</span><span class="p">(</span><span class="kp">t</span><span class="p">(</span>X<span class="p">)</span> <span class="o">%*%</span> X<span class="p">)</span> <span class="o">%*%</span> <span class="kp">t</span><span class="p">(</span>X<span class="p">)</span> <span class="o">%*%</span> trees<span class="o">$</span>Volume<span class="p">,</span> <span class="m">4</span><span class="p">)</span>
<span class="kp">beta</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<table><tbody>
<tr>
<th scope="row">(Intercept)</th>
<td>-36.9435</td>
</tr>
<tr>
<th scope="row">Girth</th>
<td>  5.0659</td>
</tr>
</tbody></table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Standard errors can be found via $\sqrt{diag(X^T X)^{-1}} \sigma$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span>se <span class="o">&lt;-</span> <span class="kp">round</span><span class="p">(</span><span class="kp">sqrt</span><span class="p">(</span><span class="kp">diag</span><span class="p">(</span><span class="kp">solve</span><span class="p">(</span><span class="kp">t</span><span class="p">(</span>X<span class="p">)</span> <span class="o">%*%</span> X<span class="p">)))</span> <span class="o">*</span> <span class="kp">sqrt</span><span class="p">(</span><span class="kp">sum</span><span class="p">(</span>model1<span class="o">$</span>res<span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="kp">nrow</span><span class="p">(</span>trees<span class="p">)</span><span class="o">-</span><span class="kp">ncol</span><span class="p">(</span>X<span class="p">))),</span> <span class="m">4</span><span class="p">)</span>
se
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<dl class="dl-horizontal">
<dt>(Intercept)</dt>
		<dd>3.3651</dd>
	<dt>Girth</dt>
		<dd>0.2474</dd>
</dl>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>t</code> values are just the coefficients divided by the standard errors.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="kp">round</span><span class="p">(</span>beta <span class="o">/</span> se<span class="p">,</span> <span class="m">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<table><tbody>
<tr>
<th scope="row">(Intercept)</th>
<td>-10.98</td>
</tr>
<tr>
<th scope="row">Girth</th>
<td> 20.48</td>
</tr>
</tbody></table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>p</code> values are found by looking up the probability distribution. The degrees of freedom is observation count minus number of parameters (where we include the intercept), and multiply by two to make the test two sided.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span>pt<span class="p">(</span><span class="o">-</span><span class="kp">abs</span><span class="p">(</span>beta <span class="o">/</span> se<span class="p">),</span> <span class="kp">nrow</span><span class="p">(</span>trees<span class="p">)</span> <span class="o">-</span> <span class="kp">ncol</span><span class="p">(</span>X<span class="p">))</span><span class="o">*</span><span class="m">2</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<table><tbody>
<tr>
<th scope="row">(Intercept)</th>
<td>7.618853e-12</td>
</tr>
<tr>
<th scope="row">Girth</th>
<td>8.664230e-19</td>
</tr>
</tbody></table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Residual-standard-error">Residual standard error<a class="anchor-link" href="posts/summarylm-in-r/#Residual-standard-error">¶</a>
</h4>
<p>Residual standard error is the <code>sd</code> of the residuals adjusted for degrees of freedom. Degrees of freedom here is number of observations (31) minus number of coeficients (2).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="kp">round</span><span class="p">(</span><span class="kp">sqrt</span><span class="p">(</span><span class="kp">sum</span><span class="p">(</span>model1<span class="o">$</span>res<span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="kp">nrow</span><span class="p">(</span>trees<span class="p">)</span><span class="o">-</span><span class="kp">ncol</span><span class="p">(</span>X<span class="p">))),</span> <span class="m">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
4.252
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="kt">c</span><span class="p">(</span>df <span class="o">=</span> <span class="kp">nrow</span><span class="p">(</span>trees<span class="p">)</span> <span class="o">-</span> <span class="m">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<strong>df:</strong> 29
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Compare to acutal <code>sd</code> of residuals.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span>sd<span class="p">(</span>model1<span class="o">$</span>residuals<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
4.18052045668671
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="R-squared">R-squared<a class="anchor-link" href="posts/summarylm-in-r/#R-squared">¶</a>
</h4>
<p>Total sum of squares (TSS) is $\sum_i {(y_i - \bar{y})^2}$, the total variation in the dataset adjusted for the mean. Residual sum of squares (RSS) is $\sum_i {(y_i - \hat{y_i})^2}$, the variation in the prediction. $R^2$, the coefficient of determination, is $1 - \frac{RSS}{TSS}$. This is the amount of explained variation. The explained sum of squares (ESS) is $\sum_i {(\hat{y_i} - \bar{y})^2}$. It is always the case that $TSS = ESS + RSS$.</p>
<p>For multiple regression, the formulas need to be put in matrix terms, see <a href="https://en.wikipedia.org/wiki/Explained_sum_of_squares">Wikipedia</a>. It is still the case that $TSS = ESS + RSS$ if a certain condition holds which (from what I can tell) it always does when using ordinary least squares.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span>TSS <span class="o">&lt;-</span> <span class="kp">sum</span><span class="p">((</span>trees<span class="o">$</span>Volume <span class="o">-</span> <span class="kp">mean</span><span class="p">(</span>trees<span class="o">$</span>Volume<span class="p">))</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
RSS <span class="o">&lt;-</span> <span class="kp">sum</span><span class="p">(</span>model1<span class="o">$</span>residuals<span class="o">^</span><span class="m">2</span><span class="p">)</span>
ESS <span class="o">&lt;-</span> <span class="kp">sum</span><span class="p">((</span>model1<span class="o">$</span>fitted.values <span class="o">-</span> <span class="kp">mean</span><span class="p">(</span>trees<span class="o">$</span>Volume<span class="p">))</span><span class="o">^</span><span class="m">2</span><span class="p">)</span>
<span class="kt">c</span><span class="p">(</span>TSS <span class="o">=</span> TSS<span class="p">,</span> ESS <span class="o">=</span> ESS<span class="p">,</span> RSS <span class="o">=</span> RSS<span class="p">,</span> <span class="sb">`ESS+RSS`</span> <span class="o">=</span> ESS <span class="o">+</span> RSS<span class="p">,</span> r2 <span class="o">=</span> <span class="m">1</span> <span class="o">-</span> RSS <span class="o">/</span> TSS<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<dl class="dl-horizontal">
<dt>TSS</dt>
		<dd>8106.08387096774</dd>
	<dt>ESS</dt>
		<dd>7581.78133230446</dd>
	<dt>RSS</dt>
		<dd>524.302538663282</dd>
	<dt>ESS+RSS</dt>
		<dd>8106.08387096774</dd>
	<dt>r2</dt>
		<dd>0.93531987245517</dd>
</dl>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Adjusted $R^2$ adds a penalty for number of predictors, $Adj. R^2 = 1 - \frac{RSS/(n-p-1)}{TSS/(n-1)} = 1 - \left(\frac{RSS}{TSS}\right)\left(\frac{n-1}{n-p-1}\right)$. Here, $p$ is the number of predictors and 1 reflects the constant term so the divisors of the sums of squares are just the degrees of freedom for each. As $p$ increases, $n-p-1$ decreases and hence the penalty $\frac{n-1}{n-p-1}$ increases.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="m">1</span> <span class="o">-</span> <span class="p">(</span>RSS<span class="o">/</span>TSS<span class="p">)</span><span class="o">*</span><span class="p">((</span><span class="kp">nrow</span><span class="p">(</span>trees<span class="p">)</span><span class="m">-1</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="kp">nrow</span><span class="p">(</span>trees<span class="p">)</span><span class="m">-1-1</span><span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
0.933089523229486
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>An ANOVA table gives the same information as well as the F-statistic from the bottom of the <code>summary</code> output.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="kp">round</span><span class="p">(</span>anova<span class="p">(</span>model1<span class="p">),</span> <span class="m">2</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<table>
<thead><tr>
<th></th>
<th scope="col">Df</th>
<th scope="col">Sum Sq</th>
<th scope="col">Mean Sq</th>
<th scope="col">F value</th>
<th scope="col">Pr(&gt;F)</th>
</tr></thead>
<tbody>
<tr>
<th scope="row">Girth</th>
<td> 1     </td>
<td>7581.78</td>
<td>7581.78</td>
<td>419.36 </td>
<td> 0     </td>
</tr>
<tr>
<th scope="row">Residuals</th>
<td>29     </td>
<td> 524.30</td>
<td>  18.08</td>
<td>    NA </td>
<td>NA     </td>
</tr>
</tbody>
</table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="p">(</span>ESS <span class="o">/</span> <span class="m">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>RSS <span class="o">/</span> <span class="m">29</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
419.360278509037
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Multi-variate-case">Multi-variate case<a class="anchor-link" href="posts/summarylm-in-r/#Multi-variate-case">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span>model2 <span class="o">&lt;-</span> lm<span class="p">(</span>Volume <span class="o">~</span> Girth <span class="o">+</span> Height<span class="p">,</span> data <span class="o">=</span> trees<span class="p">)</span>
<span class="kp">summary</span><span class="p">(</span>model2<span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_text output_subarea ">
<pre>
Call:
lm(formula = Volume ~ Girth + Height, data = trees)

Residuals:
    Min      1Q  Median      3Q     Max 
-6.4065 -2.6493 -0.2876  2.2003  8.4847 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -57.9877     8.6382  -6.713 2.75e-07 ***
Girth         4.7082     0.2643  17.816  &lt; 2e-16 ***
Height        0.3393     0.1302   2.607   0.0145 *  
---
Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1

Residual standard error: 3.882 on 28 degrees of freedom
Multiple R-squared:  0.948,	Adjusted R-squared:  0.9442 
F-statistic:   255 on 2 and 28 DF,  p-value: &lt; 2.2e-16
</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Residuals">Residuals<a class="anchor-link" href="posts/summarylm-in-r/#Residuals">¶</a>
</h4>
<p>Just like the univariate case.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="kp">round</span><span class="p">(</span>quantile<span class="p">(</span>trees<span class="o">$</span>Volume <span class="o">-</span> fitted<span class="p">(</span>model2<span class="p">)),</span> <span class="m">4</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<dl class="dl-horizontal">
<dt>0%</dt>
		<dd>-6.4065</dd>
	<dt>25%</dt>
		<dd>-2.6493</dd>
	<dt>50%</dt>
		<dd>-0.2876</dd>
	<dt>75%</dt>
		<dd>2.2003</dd>
	<dt>100%</dt>
		<dd>8.4847</dd>
</dl>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Coefficients">Coefficients<a class="anchor-link" href="posts/summarylm-in-r/#Coefficients">¶</a>
</h4>
<p>Coefficients are found by $\beta = (X^T X)^{-1} X^T y$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span>X <span class="o">&lt;-</span> model.matrix<span class="p">(</span><span class="o">~</span> Girth <span class="o">+</span> Height<span class="p">,</span> data <span class="o">=</span> trees<span class="p">)</span>
beta <span class="o">&lt;-</span> <span class="kp">round</span><span class="p">(</span><span class="kp">solve</span><span class="p">(</span><span class="kp">t</span><span class="p">(</span>X<span class="p">)</span> <span class="o">%*%</span> X<span class="p">)</span> <span class="o">%*%</span> <span class="kp">t</span><span class="p">(</span>X<span class="p">)</span> <span class="o">%*%</span> trees<span class="o">$</span>Volume<span class="p">,</span> <span class="m">4</span><span class="p">)</span>
<span class="kp">beta</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<table><tbody>
<tr>
<th scope="row">(Intercept)</th>
<td>-57.9877</td>
</tr>
<tr>
<th scope="row">Girth</th>
<td>  4.7082</td>
</tr>
<tr>
<th scope="row">Height</th>
<td>  0.3393</td>
</tr>
</tbody></table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Standard errors can be found via $\sqrt{diag(X^T X)^{-1}} \sigma$ but make sure to take off another degree of freedom.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span>se <span class="o">&lt;-</span> <span class="kp">round</span><span class="p">(</span><span class="kp">sqrt</span><span class="p">(</span><span class="kp">diag</span><span class="p">(</span><span class="kp">solve</span><span class="p">(</span><span class="kp">t</span><span class="p">(</span>X<span class="p">)</span> <span class="o">%*%</span> X<span class="p">)))</span> <span class="o">*</span> <span class="kp">sqrt</span><span class="p">(</span><span class="kp">sum</span><span class="p">(</span>model2<span class="o">$</span>res<span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="kp">nrow</span><span class="p">(</span>trees<span class="p">)</span><span class="o">-</span><span class="kp">ncol</span><span class="p">(</span>X<span class="p">))),</span> <span class="m">4</span><span class="p">)</span>
se
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<dl class="dl-horizontal">
<dt>(Intercept)</dt>
		<dd>8.6382</dd>
	<dt>Girth</dt>
		<dd>0.2643</dd>
	<dt>Height</dt>
		<dd>0.1302</dd>
</dl>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>t</code> values are just the coefficients divided by the standard errors.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="kp">round</span><span class="p">(</span>beta <span class="o">/</span> se<span class="p">,</span> <span class="kp">ncol</span><span class="p">(</span>X<span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<table><tbody>
<tr>
<th scope="row">(Intercept)</th>
<td>-6.713</td>
</tr>
<tr>
<th scope="row">Girth</th>
<td>17.814</td>
</tr>
<tr>
<th scope="row">Height</th>
<td> 2.606</td>
</tr>
</tbody></table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>p</code> values are found by looking up the probability distribution. The degrees of freedom is observation count minus number of parameters (where we include the intercept), and multiply by two to make the test two sided.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [20]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span>pt<span class="p">(</span><span class="o">-</span><span class="kp">abs</span><span class="p">(</span>beta <span class="o">/</span> se<span class="p">),</span> <span class="kp">nrow</span><span class="p">(</span>trees<span class="p">)</span> <span class="o">-</span> <span class="kp">ncol</span><span class="p">(</span>X<span class="p">))</span><span class="o">*</span><span class="m">2</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<table><tbody>
<tr>
<th scope="row">(Intercept)</th>
<td>2.749328e-07</td>
</tr>
<tr>
<th scope="row">Girth</th>
<td>8.249983e-17</td>
</tr>
<tr>
<th scope="row">Height</th>
<td>1.451141e-02</td>
</tr>
</tbody></table>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Residual-standard-error">Residual standard error<a class="anchor-link" href="posts/summarylm-in-r/#Residual-standard-error">¶</a>
</h4>
<p>Residual standard error is the <code>sd</code> of the residuals adjusted for degrees of freedom. Degrees of freedom here is number of observations (31) minus number of coeficients (3).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [21]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="kp">round</span><span class="p">(</span><span class="kp">sqrt</span><span class="p">(</span><span class="kp">sum</span><span class="p">(</span>model2<span class="o">$</span>res<span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="kp">nrow</span><span class="p">(</span>trees<span class="p">)</span><span class="o">-</span><span class="kp">ncol</span><span class="p">(</span>X<span class="p">))),</span> <span class="m">3</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
3.882
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [22]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="kt">c</span><span class="p">(</span>df <span class="o">=</span> <span class="kp">nrow</span><span class="p">(</span>trees<span class="p">)</span> <span class="o">-</span> <span class="kp">ncol</span><span class="p">(</span>X<span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<strong>df:</strong> 28
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Compare to acutal <code>sd</code> of residuals.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [23]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span>sd<span class="p">(</span>residuals<span class="p">(</span>model2<span class="p">))</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
3.75020603532858
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Session-info">Session info<a class="anchor-link" href="posts/summarylm-in-r/#Session-info">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [24]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span><span class="kp">Sys.Date</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>

<div class="output_html rendered_html output_subarea ">
<time datetime="2017-05-25">2017-05-25</time>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [25]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-r"><pre><span></span>sessionInfo<span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>


<div class="output_text output_subarea ">
<pre>R version 3.3.3 (2017-03-06)
Platform: x86_64-pc-linux-gnu (64-bit)
Running under: Ubuntu 16.04.2 LTS

locale:
 [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C              
 [3] LC_TIME=en_US.UTF-8        LC_COLLATE=en_US.UTF-8    
 [5] LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   
 [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                 
 [9] LC_ADDRESS=C               LC_TELEPHONE=C            
[11] LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

loaded via a namespace (and not attached):
 [1] R6_2.2.1            magrittr_1.5        IRdisplay_0.4.4    
 [4] pbdZMQ_0.2-6        tools_3.3.3         crayon_1.3.2       
 [7] uuid_0.1-2          stringi_1.1.5       IRkernel_0.8.6.9000
[10] jsonlite_1.4        stringr_1.2.0       digest_0.6.12      
[13] repr_0.12.0         evaluate_0.10      </pre>
</div>

</div>

</div>
</div>

</div>
    </div>
  </div>

    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/unicode-in-python/" class="u-url">Unicode in Python</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Jeremiah Perry
            </span></p>
            <p class="dateline"><a href="posts/unicode-in-python/" rel="bookmark"><time class="published dt-published" datetime="2017-05-22T12:46:43-05:00" title="2017-05-22 12:46">2017-05-22 12:46</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Unicode-in-Python">Unicode in Python<a class="anchor-link" href="posts/unicode-in-python/#Unicode-in-Python">¶</a>
</h2>
<p>I don't have to deal with unicode issues too often but when I do, I forget this stuff every time because I don't have to deal with unicode issues too often. These are my notes to help jog that memory.</p>
<p>This <a href="https://nedbatchelder.com/text/unipain.html">Ned Batchelder talk</a> is very helpful.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Code-points">Code points<a class="anchor-link" href="posts/unicode-in-python/#Code-points">¶</a>
</h3>
<p>Unicode maps "characters" to code points, or maybe it would be more accurate to say it maps code points to "characters". A code point is just a number. For example, 'A' is code point 65 and lower case Greek alpha is 945.</p>
<p>Code points are written U+dddd where <em>dddd</em> is the hex representation of the code point. So for the two examples, 'A' would typically be written U+0041 and the lower case alpha as U+03B1.</p>
<p>The definition for "characters" is quite broad, for example</p>
<p>☂</p>
<p>is a "character", the code point U+2602 (9730 in decimal, which apparently you need when you put it in HTML and markdown).</p>
<p>Here it is in python. Enter unicode code points using the \u escape.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s2">"</span><span class="se">\u2602</span><span class="s2">"</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[1]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'☂'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <a href="http://www.unicode.org">www.unicode.org</a> website has all the code points meticulously catalogued. For example, all the Greek letters can be found on <a href="http://www.unicode.org/charts/PDF/U0370.pdf">this chart</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s2">"</span><span class="se">\u03b1</span><span class="s2"> </span><span class="se">\u03b2</span><span class="s2">"</span>  <span class="c1"># alpha beta</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[2]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'α β'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Encodings">Encodings<a class="anchor-link" href="posts/unicode-in-python/#Encodings">¶</a>
</h3>
<p>Code points need to be stored on disk somehow using bytes, and this is where encodings come in.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s2">"AB"</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[3]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>b'AB'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The b at the beginning means it is a byte string. Since we are dealing with numbers in hex, let's see it that way:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s2">"AB"</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[4]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'4142'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>So what's the big deal? Different encodings produce different bytes for the same unicode, at least when the unicode contains something other than ASCII characters.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s2">"</span><span class="se">\u03b1</span><span class="s2">"</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[5]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>b'\xce\xb1'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s2">"</span><span class="se">\u03b1</span><span class="s2">"</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[6]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>b'\xce\xb1'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s2">"</span><span class="se">\u03b1</span><span class="s2">"</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">"utf-16"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[7]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>b'\xff\xfe\xb1\x03'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The default for encoding and decoding is utf-8. The <code>\xff\xfe</code> byte sequence is a byte order mark. Look it up if you want.</p>
<p>Note that 'A' (code point U+0041) encodes to 0x41 (as a byte). Also note that lower case Greek alpha (code point U+03B1) encodes to 0xCEB1 <em>when using the utf-8 encoding</em> and 0xB103 <em>when using the utf-16 encoding</em>.</p>
<p>This is the biggest source of confusion for me. The lower 7 bit ASCII code points from U+0000 up to U+007F in (almost?) all encodings are encoded as a byte that matches the code point value. 'A' (\U+0041) encodes to 0x41. But for anything above that, the encodings can and definitely do differ.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Pain">Pain<a class="anchor-link" href="posts/unicode-in-python/#Pain">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>If you have a byte string, you cannot infer the encoding, you must be told or you have to guess. If you guess wrong, you will often get garbage or even an error.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s2">"</span><span class="se">\u03b1</span><span class="s2">"</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf-16"</span><span class="p">)</span>  <span class="c1"># this should be alpha but we get something else</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[8]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'뇎'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s2">"</span><span class="se">\u03b1</span><span class="s2">"</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">"utf-16"</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">"utf-8"</span><span class="p">)</span>  <span class="c1"># utf-8 can't decode the utf-16 byte order mark</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">UnicodeDecodeError</span>                        Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-9-e3ccc79b660f&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-blue-fg">"\u03b1"</span><span class="ansi-blue-fg">.</span>encode<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"utf-16"</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>decode<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">"utf-8"</span><span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># utf-8 can't decode the utf-16 byte order mark</span>

<span class="ansi-red-fg">UnicodeDecodeError</span>: 'utf-8' codec can't decode byte 0xff in position 0: invalid start byte</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can't mix unicode and bytes.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s2">"Hello "</span> <span class="o">+</span> <span class="n">b</span><span class="s2">"World"</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">TypeError</span>                                 Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-10-dc30d6198c19&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-blue-fg">"Hello "</span> <span class="ansi-blue-fg">+</span> <span class="ansi-blue-fg">b"World"</span>

<span class="ansi-red-fg">TypeError</span>: Can't convert 'bytes' object to str implicitly</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Python-types">Python types<a class="anchor-link" href="posts/unicode-in-python/#Python-types">¶</a>
</h3>
<p>Bytes are not unicode and unicode is not bytes. I'm sure that sentence has a grammatical error. Unicode in python (3) is type 'str' by the way.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="s2">"AB"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[11]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>str</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">b</span><span class="s2">"AB"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[12]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>bytes</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>What is an encoding? It takes unicode and converts it to bytes.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s2">"AB"</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[13]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>b'AB'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can't encode bytes--they are already encoded.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [14]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="s2">"AB"</span><span class="o">.</span><span class="n">encode</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-14-7ccaee2cd1c1&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-blue-fg">b"AB"</span><span class="ansi-blue-fg">.</span>encode<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">AttributeError</span>: 'bytes' object has no attribute 'encode'</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And you can't decode unicode.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="s2">"AB"</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-15-783efba8a48e&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span><span class="ansi-blue-fg">()</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span><span class="ansi-blue-fg">"AB"</span><span class="ansi-blue-fg">.</span>decode<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">AttributeError</span>: 'str' object has no attribute 'decode'</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Decoding takes bytes and produces unicode.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="s2">"AB"</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[16]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'AB'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Misc">Misc<a class="anchor-link" href="posts/unicode-in-python/#Misc">¶</a>
</h2>
<h3 id="Hex-and-such">Hex and such<a class="anchor-link" href="posts/unicode-in-python/#Hex-and-such">¶</a>
</h3>
<p>Convert bytes to hex:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">b</span><span class="s1">'A</span><span class="se">\xbe</span><span class="s1">'</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[17]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>'41be'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Convert hex to bytes:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="s1">'41be'</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt output_prompt">Out[18]:</div>


<div class="output_text output_subarea output_execute_result">
<pre>b'A\xbe'</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Python-escape-sequences">Python escape sequences<a class="anchor-link" href="posts/unicode-in-python/#Python-escape-sequences">¶</a>
</h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In [19]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">prnt</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="s2">"evals to"</span><span class="p">,</span> <span class="nb">eval</span><span class="p">(</span><span class="s2">"</span><span class="se">\"</span><span class="s2">"</span> <span class="o">+</span> <span class="n">val</span> <span class="o">+</span> <span class="s2">"</span><span class="se">\"</span><span class="s2">"</span><span class="p">))</span>


<span class="c1"># \xhh: enter a character using hex where 'hh' is the hex value</span>
<span class="n">prnt</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">x41"</span><span class="p">)</span>  <span class="c1"># 0x41 = 65 which is 'A' in ASCII</span>
<span class="n">prnt</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">x61"</span><span class="p">)</span>  <span class="c1">#                    'a' in ASCII</span>

<span class="c1"># \ooo: enter a character as octal</span>
<span class="n">prnt</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">101"</span><span class="p">)</span>  <span class="c1"># 0101 = 65 in octal</span>

<span class="c1"># \uXXXX: 16-bit hex value unicode</span>
<span class="n">prnt</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">u03b1"</span><span class="p">)</span>

<span class="c1"># \N{NAME}: named unicode</span>
<span class="n">prnt</span><span class="p">(</span><span class="s2">"</span><span class="se">\\</span><span class="s2">N{GREEK SMALL LETTER ALPHA}"</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">
<div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>\x41 evals to A
\x61 evals to a
\101 evals to A
\u03b1 evals to α
\N{GREEK SMALL LETTER ALPHA} evals to α
</pre>
</div>
</div>

</div>
</div>

</div>
    </div>
  </div>

    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/r-tip-devoff/" class="u-url">R tip: dev.off()</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Jeremiah Perry
            </span></p>
            <p class="dateline"><a href="posts/r-tip-devoff/" rel="bookmark"><time class="published dt-published" datetime="2017-05-19T08:13:44-05:00" title="2017-05-19 08:13">2017-05-19 08:13</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>When plotting in R and changing parameters via <code>par</code>, I have been very
careful about saving and restoring them:</p>
<pre class="code literal-block"><span></span>old <span class="o">&lt;-</span> par<span class="p">()</span>
par<span class="p">(</span>mar <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">7.1</span><span class="p">,</span> <span class="m">4.1</span><span class="p">,</span> <span class="m">4.1</span><span class="p">,</span> <span class="m">2.1</span><span class="p">))</span>
<span class="c1">## plot something, then restore:</span>
par<span class="p">(</span>old<span class="p">)</span>
</pre>


<p>If you do that as is, you will get several warnings when you call
<code>par(old)</code> about parameters that cannot be set. The way around that is
to pass the <code>no.readonly</code> flag:</p>
<pre class="code literal-block"><span></span>old <span class="o">&lt;-</span> par<span class="p">(</span>no.readonly <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="c1">## ...</span>
par<span class="p">(</span>old<span class="p">)</span>
</pre>


<p>If you are like me, you always call it the first way until you get the
warnings, then call it the second way and you get annoyed that you
have to type All That Extra Stuff.</p>
<p>One thing I learned this week is <code>par</code> returns a list of the old
parameters that you are setting. So for example,</p>
<pre class="code literal-block"><span></span>old <span class="o">&lt;-</span> par<span class="p">(</span>mar <span class="o">=</span> <span class="kt">c</span><span class="p">(</span><span class="m">7.1</span><span class="p">,</span> <span class="m">4.1</span><span class="p">,</span> <span class="m">4.1</span><span class="p">,</span> <span class="m">2.1</span><span class="p">))</span>
</pre>


<p><code>old</code> now only has one element named <code>mar</code> which has the old value in
it. Calling</p>
<pre class="code literal-block"><span></span>par<span class="p">(</span>old<span class="p">)</span>
</pre>


<p>now only resets that one value that was changed.</p>
<p>I've always thought the <code>par</code> function changed parameters per session.
The second thing I learned this week is the <code>par</code> function sets
parameters per device. That's not exactly a secret; the first line of
the Details section when you <code>?par</code> says</p>
<blockquote>
<p>Each device has its own set of graphical parameters.</p>
</blockquote>
<p>That means that to drop all parameter changes and go back to the
defaults, we can just call e.g.</p>
<pre class="code literal-block"><span></span>dev.new<span class="p">()</span>
</pre>


<p>or even <code>dev.off()</code>. No need to capture and restore anything.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/newtons-method/" class="u-url">Newton's Method</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Jeremiah Perry
            </span></p>
            <p class="dateline"><a href="posts/newtons-method/" rel="bookmark"><time class="published dt-published" datetime="2017-05-12T09:33:57-05:00" title="2017-05-12 09:33">2017-05-12 09:33</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Newton's-Method">Newton's Method<a class="anchor-link" href="posts/newtons-method/#Newton's-Method">¶</a>
</h2>
<p>After posting the <a href="posts/risk-parity-weights-in-r">R code for calculating risk parity weights</a>, I thought I should review Newton's method.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Univariate">Univariate<a class="anchor-link" href="posts/newtons-method/#Univariate">¶</a>
</h3>
<p>First, from the definition of a derivative for a function, we have</p>
<p>$\frac{f(x+h) - f(x)}{h} = f'(x) + E(x,h)$</p>
<p>Here $E$ is the error introduced by the approximation</p>
<p>$f(x+h) \approx f(x) + h f'(x)$</p>
<p>and if the derivative $f'(x)$ exists, $E$ must obey $ \lim_{h \to 0} E(x,h) = 0$.</p>
<p>Rearranging the equation gives</p>
<p>$f(x+h) = f(x) + hf'(x) + hE(x,h)$</p>
<p>This is a form of the first order Taylor polynomial. Since $E \rightarrow 0$ as $h \rightarrow 0$, $hE(x,h)$ is "small".</p>
<p>The goal is to find a zero, i.e. some $a$ such that $f(a) = 0$. Using the above and the smallness of $hE(x,h)$, a first order approximation for the zero will be to find $h$ such that $f(x+h) = 0$. Using that above we get</p>
<p>$0 = f(x) + hf'(x)$</p>
<p>Solving for $h$ gives</p>
<p>$h = -\frac{f(x)}{f'(x)}$</p>
<p>so our guess for the root $a = x+h$ is</p>
<p>$x - \frac{f(x)}{f'(x)}$</p>
<p>Making successive approximations yields a sequence</p>
<p>$x_{n+1} = x_n - \frac{f(x_n)}{f'(x_n)}$</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Multivariate">Multivariate<a class="anchor-link" href="posts/newtons-method/#Multivariate">¶</a>
</h3>
<p>The first order Taylor polynomial has a multivariate generalization:</p>
<p>$f(x+h) = f(x) + T_x(h) + \|h\| E(x,h)$</p>
<p>where $T_x(h)$ is the total derivative which is represented by the Jacobian matrix, a matrix where row $i$ and column $j$ is</p>
<p>$\frac{\partial f_i}{\partial x_j}$,</p>
<p>the partial derivative of the function $i$ with respect to variable $j$. We are dealing in higher dimensions now so $x$ and $h$ are vectors and $f$ is a function $\mathbb{R}^n \rightarrow \mathbb{R}^m$. We will be inverting the Jacobian so we will in fact need $n = m$.</p>
<p>Our first order approximation becomes</p>
<p>$0 = f(x) + J(x) \cdot h$</p>
<p>Solving for $h$ gives</p>
<p>$h = -[J(x)]^{-1} f(x)$</p>
<p>and so the guess for the roots become</p>
<p>$x - [J(x)]^{-1} f(x)$</p>
<p>As a sequence, we can write</p>
<p>$x_{n+1} = x_n - [J(x_n)]^{-1} f(x_n)$</p>
<p>This is the form of the solver used in the paper.</p>

</div>
</div>
</div>
    </div>
  </div>

    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/risk-parity-weights-in-r/" class="u-url">Risk Parity Weights in R</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Jeremiah Perry
            </span></p>
            <p class="dateline"><a href="posts/risk-parity-weights-in-r/" rel="bookmark"><time class="published dt-published" datetime="2017-05-05T13:50:55-05:00" title="2017-05-05 13:50">2017-05-05 13:50</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>Every now and then I need to calculate risk parity weights in R. I
like to know how things are working under the hood and the solutions I
found were a little opaque. Fortunately I found a nice article that
gives a straightforward algorithm,
see <a href="http://www.iinews.com/site/pdfs/joi_fall_2012_ra1.pdf">here</a>.</p>
<p>Here is my R code to implement it. This is from the "Algorithm 1:
Newton's method" section in the paper.</p>
<pre class="code literal-block"><span></span>riskparity <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>sigma<span class="p">,</span> tol <span class="o">=</span> <span class="m">1e-7</span><span class="p">,</span> maxeval <span class="o">=</span> <span class="m">1000</span><span class="p">)</span> <span class="p">{</span>
  <span class="bp">F</span> <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">,</span> lambda<span class="p">)</span> <span class="p">{</span>
    mat <span class="o">&lt;-</span> sigma <span class="o">%*%</span> x <span class="o">-</span> lambda <span class="o">*</span> <span class="m">1</span><span class="o">/</span>x
    <span class="kp">rbind</span><span class="p">(</span>mat<span class="p">,</span> <span class="kp">sum</span><span class="p">(</span>x<span class="p">)</span> <span class="o">-</span> <span class="m">1</span><span class="p">)</span>
  <span class="p">}</span>

  J <span class="o">&lt;-</span> <span class="kr">function</span><span class="p">(</span>x<span class="p">,</span> lambda<span class="p">)</span> <span class="p">{</span>
    mat <span class="o">&lt;-</span> sigma <span class="o">+</span> lambda <span class="o">*</span> <span class="kp">diag</span><span class="p">(</span><span class="m">1</span><span class="o">/</span>x<span class="o">^</span><span class="m">2</span><span class="p">)</span>
    mat <span class="o">&lt;-</span> <span class="kp">rbind</span><span class="p">(</span>mat<span class="p">,</span> <span class="kp">rep</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="kp">ncol</span><span class="p">(</span>sigma<span class="p">)))</span>
    <span class="kp">cbind</span><span class="p">(</span>mat<span class="p">,</span> <span class="kt">c</span><span class="p">(</span><span class="m">-1</span><span class="o">/</span>x<span class="p">,</span> <span class="m">0</span><span class="p">))</span>
  <span class="p">}</span>

  w <span class="o">&lt;-</span> <span class="m">1</span> <span class="o">/</span> <span class="kp">sqrt</span><span class="p">(</span><span class="kp">diag</span><span class="p">(</span>sigma<span class="p">))</span>
  w <span class="o">&lt;-</span> <span class="kt">c</span><span class="p">(</span>w <span class="o">/</span> <span class="kp">sum</span><span class="p">(</span>w<span class="p">),</span> <span class="m">0.5</span><span class="p">)</span> <span class="c1"># add guess for lambda at the end</span>
  N <span class="o">&lt;-</span> <span class="kp">length</span><span class="p">(</span>w<span class="p">)</span>

  cureval <span class="o">&lt;-</span> <span class="m">0</span>
  <span class="kr">while</span> <span class="p">(</span>cureval <span class="o">&lt;</span> maxeval<span class="p">)</span> <span class="p">{</span>
    cureval <span class="o">&lt;-</span> cureval <span class="o">+</span> <span class="m">1</span>
    wn <span class="o">&lt;-</span> w <span class="o">-</span> <span class="kp">solve</span><span class="p">(</span>J<span class="p">(</span>w<span class="p">[</span><span class="o">-</span>N<span class="p">],</span> w<span class="p">[</span>N<span class="p">]))</span> <span class="o">%*%</span> <span class="bp">F</span><span class="p">(</span>w<span class="p">[</span><span class="o">-</span>N<span class="p">],</span> w<span class="p">[</span>N<span class="p">])</span>
    <span class="kr">if</span> <span class="p">(</span><span class="kp">sqrt</span><span class="p">(</span><span class="kp">sum</span><span class="p">(</span>wn <span class="o">-</span> w<span class="p">)</span><span class="o">^</span><span class="m">2</span><span class="p">)</span> <span class="o">&lt;</span> tol<span class="p">)</span> <span class="p">{</span>
      <span class="kr">return</span><span class="p">(</span><span class="kt">list</span><span class="p">(</span>w <span class="o">=</span> w<span class="p">[</span><span class="o">-</span>N<span class="p">],</span> lambda <span class="o">=</span> w<span class="p">[</span>N<span class="p">],</span> status <span class="o">=</span> <span class="s">"converge"</span><span class="p">))</span>
    <span class="p">}</span>
    w <span class="o">&lt;-</span> wn
  <span class="p">}</span>

  <span class="kt">list</span><span class="p">(</span>w <span class="o">=</span> w<span class="p">[</span><span class="o">-</span>N<span class="p">],</span> lambda <span class="o">=</span> w<span class="p">[</span>N<span class="p">],</span> status <span class="o">=</span> <span class="s">"maxeval"</span><span class="p">)</span>
<span class="p">}</span>
</pre>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/reading-a-utf-8-csv-file-from-excel/" class="u-url">Reading a UTF-8 csv file from Excel</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Jeremiah Perry
            </span></p>
            <p class="dateline"><a href="posts/reading-a-utf-8-csv-file-from-excel/" rel="bookmark"><time class="published dt-published" datetime="2017-04-28T08:28:59-05:00" title="2017-04-28 08:28">2017-04-28 08:28</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>I recently upgraded to Windows 10 at work and the latest and greatest
version of Excel. I went to save a csv file to read into R and did not
realize I selected the "UTF-8" option.</p>
<p>When I read it into R, I saw three strange extra characters in the
first column name. No expert am I in unicode but I know enough to
recognize this was probably a byte-order mark and just needed to be
read differently.</p>
<p>I looked at the arg list for <code>read.csv</code> and tried the following:</p>
<pre class="code literal-block"><span></span>X <span class="o">&lt;-</span> read.csv<span class="p">(</span>filename<span class="p">,</span> encoding <span class="o">=</span> <span class="s">"utf-8"</span><span class="p">)</span>
</pre>


<p>This seemed very sensible to me since <code>encoding</code> is pretty standard
for this sort of thing in e.g. python. It did not work and when I
looked closer, I realized there was another argument, <code>fileEncoding</code>:</p>
<pre class="code literal-block"><span></span>X <span class="o">&lt;-</span> read.csv<span class="p">(</span>filename<span class="p">,</span> fileEncoding <span class="o">=</span> <span class="s">"utf-8"</span><span class="p">)</span>
</pre>


<p>Oddly, this did not work either. At this point I started mumbling
incoherently.</p>
<p>Naturally, Hadley came to my rescue when I read his answer to <a href="http://stackoverflow.com/questions/21624796/read-a-utf-8-text-file-with-bom">this
StackOverflow question</a>. 
Seems that in R, the correct "encoding" is "utf-8-bom" where bom
stands for byte order mark:</p>
<pre class="code literal-block"><span></span>X <span class="o">&lt;-</span> read.csv<span class="p">(</span>filename<span class="p">,</span> fileEncoding <span class="o">=</span> <span class="s">"utf-8-bom"</span><span class="p">)</span>
</pre>


<p>At last. Why do I have to use <code>fileEncoding</code> instead of just
<code>encoding</code>, and what does the <code>encoding</code> variable do anyway? Why do I
have to put "utf-8-bom" instead of just "utf-8"? Why does Excel feel
compelled to put a byte order mark in a UTF-8 file? If I were
industrious and curious, I would find out, but I am lazy and
uninterested so for now it will stay a mystery.</p>
</div>
    </div>
    </article><article class="h-entry post-text"><header><h1 class="p-name entry-title"><a href="posts/consecutive-composite-numbers/" class="u-url">Consecutive Composite Numbers</a></h1>
        <div class="metadata">
            <p class="byline author vcard"><span class="byline-name fn">
                Jeremiah Perry
            </span></p>
            <p class="dateline"><a href="posts/consecutive-composite-numbers/" rel="bookmark"><time class="published dt-published" datetime="2017-04-20T12:57:07-05:00" title="2017-04-20 12:57">2017-04-20 12:57</time></a></p>
        </div>
    </header><div class="e-content entry-content">
    <div>
<p>I recently read that there exist strings of consecutive composite
numbers of arbitrary length. That hurts my head, just a little. So
even though there are infinitely many prime numbers, the gaps between
them can be arbitrarily long.</p>
<p>To generate a sequence of <code>n</code> numbers that are composite, take
<code>(n+1)! + 2</code>, <code>(n+1)! + 3</code>, ..., up to <code>(n+1)! + n+1</code>. That has <code>n</code>
numbers in it and each is composite: the first is divisible by 2, the
second is divisible by 3, etc.</p>
</div>
    </div>
    </article>
</div>





            <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"> </script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'left', // Change this to 'center' to center equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script>
</div>
        <!--End of body content-->

        <footer id="footer">
            Contents © 2017         <a href="mailto:">Jeremiah Perry</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
        </footer>
</div>
</div>


            <script src="assets/js/all-nocdn.js"></script><script>$('a.image-reference:not(.islink) img:not(.islink)').parent().colorbox({rel:"gal",maxWidth:"100%",maxHeight:"100%",scalePhotos:true});</script><!-- fancy dates --><script>
    moment.locale("en");
    fancydates(0, "YYYY-MM-DD HH:mm");
    </script><!-- end fancy dates -->
</body>
</html>
